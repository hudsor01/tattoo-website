# Test info

- Name: Admin Dashboard >> should allow admin users to log in
- Location: /Users/richard/Developer/tattoo-website/tests/admin-dashboard.spec.ts:27:7

# Error details

```
Error: page.goto: net::ERR_CONNECTION_REFUSED at http://localhost:3002/admin
Call log:
  - navigating to "http://localhost:3002/admin", waiting until "load"

    at /Users/richard/Developer/tattoo-website/tests/admin-dashboard.spec.ts:28:16
```

# Test source

```ts
   1 | import { test, expect } from '@playwright/test';
   2 |
   3 | /**
   4 |  * Admin Dashboard Functionality Tests
   5 |  * 
   6 |  * These tests verify the functionality of the Cal.com analytics dashboard
   7 |  * and confirm that the UI components work as expected.
   8 |  */
   9 |
   10 | test.describe('Admin Dashboard', () => {
   11 |   // Test the admin login and authentication
   12 |   test('should show login form to unauthenticated users', async ({ page }) => {
   13 |     await page.goto('/admin');
   14 |     
   15 |     // Wait for hydration to complete
   16 |     await page.waitForTimeout(1000);
   17 |     
   18 |     // Expect to see login form
   19 |     const loginForm = await page.getByRole('heading', { name: /admin login/i });
   20 |     await expect(loginForm).toBeVisible();
   21 |     
   22 |     // Take a screenshot of the login form
   23 |     await page.screenshot({ path: 'admin-login.png' });
   24 |   });
   25 |
   26 |   // Test login functionality (using test admin credentials)
   27 |   test('should allow admin users to log in', async ({ page }) => {
>  28 |     await page.goto('/admin');
      |                ^ Error: page.goto: net::ERR_CONNECTION_REFUSED at http://localhost:3002/admin
   29 |     
   30 |     // Wait for hydration to complete
   31 |     await page.waitForTimeout(1000);
   32 |     
   33 |     // Get environment variables for login (these should be set in your test environment)
   34 |     const adminEmail = process.env.TEST_ADMIN_EMAIL || 'admin@example.com';
   35 |     const adminPassword = process.env.TEST_ADMIN_PASSWORD || 'password';
   36 |     
   37 |     // Fill in login form
   38 |     await page.getByLabel(/email/i).fill(adminEmail);
   39 |     await page.getByLabel(/password/i).fill(adminPassword);
   40 |     await page.getByRole('button', { name: /sign in/i }).click();
   41 |     
   42 |     // Wait for dashboard to load (might take longer in production)
   43 |     await page.waitForTimeout(3000);
   44 |     
   45 |     // Check if dashboard loaded
   46 |     const dashboardTitle = await page.getByRole('heading', { name: /admin dashboard/i });
   47 |     await expect(dashboardTitle).toBeVisible();
   48 |     
   49 |     // Take a screenshot of the dashboard
   50 |     await page.screenshot({ path: 'admin-dashboard.png' });
   51 |   });
   52 |
   53 |   // The following test should only run if you're already authenticated as admin
   54 |   test('should display Cal.com analytics when authenticated', async ({ page }) => {
   55 |     // Go to the admin page
   56 |     await page.goto('/admin');
   57 |     
   58 |     // Wait for hydration and possible authentication
   59 |     await page.waitForTimeout(3000);
   60 |     
   61 |     // Try to find the dashboard content
   62 |     const dashboardTitle = await page.getByText(/admin dashboard/i, { exact: false });
   63 |     
   64 |     // If we're not logged in, skip this test
   65 |     if (!(await dashboardTitle.isVisible())) {
   66 |       test.skip();
   67 |       return;
   68 |     }
   69 |     
   70 |     // Check if analytics tab is present
   71 |     const analyticsTab = await page.getByText(/cal\.com analytics/i, { exact: false });
   72 |     await expect(analyticsTab).toBeVisible();
   73 |     
   74 |     // Take screenshot of analytics dashboard
   75 |     await page.screenshot({ path: 'cal-analytics-dashboard.png' });
   76 |     
   77 |     // Test period selector functionality
   78 |     const periodSelector = await page.getByText(/7 days/i);
   79 |     await periodSelector.click();
   80 |     
   81 |     // Choose 30 days period
   82 |     const thirtyDaysPeriod = await page.getByText(/30 days/i);
   83 |     await thirtyDaysPeriod.click();
   84 |     
   85 |     // Wait for data to refresh
   86 |     await page.waitForTimeout(1000);
   87 |     
   88 |     // Take screenshot after period change
   89 |     await page.screenshot({ path: 'cal-analytics-30days.png' });
   90 |     
   91 |     // Test tabbed interface - switch to bookings tab
   92 |     const bookingsTab = await page.getByRole('tab', { name: /bookings/i });
   93 |     await bookingsTab.click();
   94 |     
   95 |     // Wait for tab to show
   96 |     await page.waitForTimeout(500);
   97 |     
   98 |     // Take screenshot of bookings tab
   99 |     await page.screenshot({ path: 'cal-analytics-bookings.png' });
  100 |     
  101 |     // Test sync functionality
  102 |     const syncButton = await page.getByRole('button', { name: /sync cal\.com/i });
  103 |     await syncButton.click();
  104 |     
  105 |     // Wait for sync to complete
  106 |     await page.waitForTimeout(2000);
  107 |     
  108 |     // Take screenshot after sync
  109 |     await page.screenshot({ path: 'cal-analytics-after-sync.png' });
  110 |   });
  111 |
  112 |   // Test error states by breaking the API connection
  113 |   // Note: This test is commented out as it requires manual setup to break the API
  114 |   // test('should handle API errors gracefully', async ({ page }) => {
  115 |   //   // First, break the API connection (this would need to be done manually)
  116 |   //   // For example, by changing the API URL to an invalid one
  117 |   //   
  118 |   //   // Then load the admin page
  119 |   //   await page.goto('/admin');
  120 |   //   
  121 |   //   // Wait for hydration and possible authentication
  122 |   //   await page.waitForTimeout(3000);
  123 |   //   
  124 |   //   // Check if error state is shown
  125 |   //   const errorMessage = await page.getByText(/there was a problem loading/i);
  126 |   //   await expect(errorMessage).toBeVisible();
  127 |   //   
  128 |   //   // Take screenshot of error state
```